<!-- 保存一覧を表示するエリア -->
<section>
  <h2>📚 保存された過去の入力一覧</h2>
  <div id="saved-entries"></div>
</section>

<script>
  // 保存されたデータを取得
  function getSavedData() {
    return JSON.parse(localStorage.getItem("homerareSteps")) || [];
  }

  // 保存データをセット
  function setSavedData(data) {
    localStorage.setItem("homerareSteps", JSON.stringify(data));
  }

  // 削除処理
  function deleteEntry(index) {
    const data = getSavedData();
    data.splice(index, 1);
    setSavedData(data);
    displaySavedEntries();
  }

  // 復元処理
  function restoreEntry(index) {
    const data = getSavedData();
    const steps = data[index].steps;
    steps.forEach((stepData, stepIndex) => {
      const inputs = document.querySelectorAll(`.step${stepIndex}`);
      stepData.forEach((val, i) => {
        if (inputs[i]) inputs[i].value = val;
      });
    });
    updateProgress();
    alert("この記録を復元しました！");
  }

  // 表示処理
  function displaySavedEntries() {
    const savedData = getSavedData();
    const container = document.getElementById("saved-entries");
    container.innerHTML = "";

    if (savedData.length === 0) {
      container.innerHTML = "<p>保存された記録はまだありません。</p>";
      return;
    }

    savedData.forEach((entry, index) => {
      const entryDiv = document.createElement("div");
      entryDiv.classList.add("saved-entry");
      entryDiv.innerHTML = `
        <h3>記録 ${index + 1}（${entry.timestamp}）</h3>
        <ul>
          ${entry.steps
            .map((step, i) => `<li><strong>STEP${i}:</strong> ${step.join(", ")}</li>`)
            .join("")}
        </ul>
        <button onclick="restoreEntry(${index})">この記録を復元</button>
        <button onclick="deleteEntry(${index})">削除</button>
        <hr />
      `;
      container.appendChild(entryDiv);
    });
  }

  // 初期表示
  window.addEventListener("DOMContentLoaded", () => {
    displaySavedEntries();
  });
</script>

<style>
  .saved-entry {
    background: #fff7ec;
    padding: 1em;
    border-radius: 8px;
    margin-bottom: 1em;
  }
  .saved-entry button {
    margin-right: 0.5em;
    background: #ffcc80;
    border: none;
    padding: 0.4em 0.8em;
    border-radius: 4px;
    cursor: pointer;
  }
  .saved-entry button:hover {
    background: #ffb74d;
  }
</style>
